<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>The ZipArchive Library: ZipFileHeader.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff" leftmargin="32" marginwidth="32" topmargin="32" marginheight="32">
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>ZipFileHeader.h</h1><a href="ZipFileHeader_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//&lt;!-- Code:License --&gt;</span>
<a name="l00002"></a>00002 
<a name="l00009"></a>00009 <span class="preprocessor">#if !defined(ZIPARCHIVE_ZIPFILEHEADER_DOT_H)</span>
<a name="l00010"></a><a class="code" href="ZipFileHeader_8h.html#ea58a5838e50ca95e04926ba2449754e">00010</a> <span class="preprocessor"></span><span class="preprocessor">#define ZIPARCHIVE_ZIPFILEHEADER_DOT_H</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="preprocessor">#if _MSC_VER &gt; 1000</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#endif // _MSC_VER &gt; 1000</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "ZipExport.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="ZipStorage_8h.html">ZipStorage.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="ZipAutoBuffer_8h.html">ZipAutoBuffer.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "sys/types.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="ZipCompatibility_8h.html">ZipCompatibility.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "ZipCollections.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="ZipExtraField_8h.html">ZipExtraField.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "ZipStringStoreSettings.h"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="BytesWriter_8h.html">BytesWriter.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="ZipCryptograph_8h.html">ZipCryptograph.h</a>"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef _ZIP64</span>
<a name="l00028"></a><a class="code" href="ZipFileHeader_8h.html#d7f90d101d17237304953eacefc5fc59">00028</a> <span class="preprocessor"></span><span class="preprocessor"> #define ZIP_ZIP64_ARCHIVE_VERSION 45</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="classCZipFileHeader.html">00034</a> <span class="keyword">class </span>ZIP_API <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>  
<a name="l00035"></a>00035 {
<a name="l00036"></a><a class="code" href="classCZipFileHeader.html#f6d01476466aee6dee41ca64e3f4f263">00036</a>  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCZipCentralDir.html">CZipCentralDir</a>;
<a name="l00037"></a><a class="code" href="classCZipFileHeader.html#6d8d6fabc568f6e624a2ec3da02e928e">00037</a>  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCZipArchive.html">CZipArchive</a>;
<a name="l00038"></a>00038 <span class="keyword">public</span>: 
<a name="l00039"></a>00039  <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>();
<a name="l00040"></a><a class="code" href="classCZipFileHeader.html#dcb832779ca05c5abd0fb100dae30f38">00040</a>  <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>(<span class="keyword">const</span> <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>&amp; header)
<a name="l00041"></a>00041  {
<a name="l00042"></a>00042   *<span class="keyword">this</span> = header;
<a name="l00043"></a>00043  }
<a name="l00044"></a>00044  <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>&amp; header);
<a name="l00045"></a>00045  <span class="keyword">virtual</span> ~<a class="code" href="classCZipFileHeader.html">CZipFileHeader</a>();
<a name="l00046"></a>00046 
<a name="l00053"></a><a class="code" href="classCZipFileHeader.html#ad29e53f924aa4369ac77320d8077aa5">00053</a>  <span class="keywordtype">int</span> PredictFileNameSize()<span class="keyword"> const </span>
<a name="l00054"></a>00054 <span class="keyword"> </span>{
<a name="l00055"></a>00055   <span class="keywordflow">if</span> (m_pszFileNameBuffer.IsAllocated())
<a name="l00056"></a>00056    <span class="keywordflow">return</span> m_pszFileNameBuffer.GetSize();
<a name="l00057"></a>00057   <a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a> buffer;
<a name="l00058"></a>00058   ConvertFileName(buffer);
<a name="l00059"></a>00059   <span class="keywordflow">return</span> buffer.<a class="code" href="classCZipAutoBuffer.html#033279125a002b0caf897f456a8c89ee">GetSize</a>();
<a name="l00060"></a>00060  }
<a name="l00061"></a>00061 
<a name="l00068"></a><a class="code" href="classCZipFileHeader.html#b44182ec442ad15f32ea87963813d543">00068</a>  WORD GetCommentSize()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (WORD)m_pszComment.GetSize();}
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00091"></a>00091  CZipString&amp; GetFileName(<span class="keywordtype">bool</span> bClearBuffer = <span class="keyword">true</span>);
<a name="l00092"></a>00092 
<a name="l00099"></a>00099  <span class="keywordtype">void</span> SetFileName(LPCTSTR lpszFileName);
<a name="l00100"></a>00100 
<a name="l00107"></a>00107  CZipString GetComment() <span class="keyword">const</span>;
<a name="l00108"></a>00108 
<a name="l00115"></a>00115  <span class="keywordtype">void</span> SetComment(LPCTSTR lpszComment);
<a name="l00116"></a>00116 
<a name="l00122"></a><a class="code" href="classCZipFileHeader.html#651099de4ebb7f5afc2b9a8392f7b37b">00122</a>  <span class="keywordtype">bool</span> IsDataDescr()<span class="keyword">const </span>{ <span class="keywordflow">return</span> (m_uFlag &amp; (WORD) 8) != 0;}
<a name="l00123"></a>00123 
<a name="l00135"></a><a class="code" href="classCZipFileHeader.html#f8e4368910bda3fe2d77316bd0b5e48c">00135</a>  WORD GetDataDescriptorSize(<span class="keyword">const</span> <a class="code" href="classCZipStorage.html">CZipStorage</a>* pStorage)<span class="keyword"> const</span>
<a name="l00136"></a>00136 <span class="keyword"> </span>{
<a name="l00137"></a>00137   <span class="keywordflow">return</span> GetDataDescriptorSize(pStorage-&gt;<a class="code" href="classCZipStorage.html#487495e8e77ade5959e8269aabe9baf9">IsSegmented</a>() != 0 || IsEncrypted());
<a name="l00138"></a>00138  }
<a name="l00139"></a>00139 
<a name="l00151"></a><a class="code" href="classCZipFileHeader.html#ceabe61a8930a316a5407bc5de11ba02">00151</a>  WORD GetDataDescriptorSize(<span class="keywordtype">bool</span> bConsiderSignature = <span class="keyword">false</span>)<span class="keyword"> const</span>
<a name="l00152"></a>00152 <span class="keyword"> </span>{
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (IsDataDescr())
<a name="l00154"></a>00154   {
<a name="l00155"></a>00155    
<a name="l00156"></a>00156 <span class="preprocessor">#ifdef _ZIP64   </span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>   WORD size = (WORD)(m_uComprSize &gt;= UINT_MAX || m_uUncomprSize &gt;= UINT_MAX ? 20 : 12);
<a name="l00158"></a>00158 <span class="preprocessor">#else</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span>   WORD size = 12;
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (WORD)(bConsiderSignature ? size + 4 : size);
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="keywordflow">else</span>
<a name="l00164"></a>00164    <span class="keywordflow">return</span> 0;
<a name="l00165"></a>00165  } 
<a name="l00166"></a>00166 
<a name="l00184"></a><a class="code" href="classCZipFileHeader.html#d87cf27f8a60c14c3f0e61792984ceea">00184</a>  ZIP_U32_U64 GetDataSize(<span class="keywordtype">bool</span> bUseLocal = <span class="keyword">false</span>, <span class="keywordtype">bool</span> bReal = <span class="keyword">true</span>)<span class="keyword"> const</span>
<a name="l00185"></a>00185 <span class="keyword"> </span>{
<a name="l00186"></a>00186   ZIP_U32_U64 uSize = bUseLocal ? m_uLocalComprSize : m_uComprSize;
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (bReal)
<a name="l00188"></a>00188    uSize -= GetEncryptedInfoSize();
<a name="l00189"></a>00189   <span class="keywordflow">else</span>
<a name="l00190"></a>00190    uSize += GetEncryptedInfoSize();
<a name="l00191"></a>00191   <span class="keywordflow">return</span> uSize;
<a name="l00192"></a>00192  }
<a name="l00193"></a>00193 
<a name="l00200"></a>00200  DWORD GetSize()<span class="keyword">const</span>;
<a name="l00201"></a>00201 
<a name="l00213"></a>00213  DWORD GetLocalSize(<span class="keywordtype">bool</span> bReal) <span class="keyword">const</span>; 
<a name="l00214"></a>00214 
<a name="l00222"></a><a class="code" href="classCZipFileHeader.html#21a76d9ede8909e7b35b88ad0087c0b2">00222</a>  <span class="keywordtype">bool</span> CompressionEfficient()
<a name="l00223"></a>00223  {
<a name="l00224"></a>00224   ZIP_U32_U64 uBefore = m_uUncomprSize;
<a name="l00225"></a>00225   <span class="comment">// ignore the length of encryption info </span>
<a name="l00226"></a>00226   ZIP_U32_U64 uAfter = GetDataSize(<span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l00227"></a>00227   <span class="keywordflow">return</span>  uAfter &lt;= uBefore;
<a name="l00228"></a>00228  }
<a name="l00229"></a>00229 
<a name="l00236"></a><a class="code" href="classCZipFileHeader.html#e80838388b3587fe2d43109b1177016a">00236</a>  <span class="keywordtype">float</span> GetCompressionRatio()
<a name="l00237"></a>00237  {
<a name="l00238"></a>00238 <span class="preprocessor">#if _MSC_VER &gt;= 1300 || !defined(_ZIP64)</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>  <span class="keywordflow">return</span> m_uUncomprSize ? ((float)m_uComprSize * 100 ) / m_uUncomprSize: 0;
<a name="l00240"></a>00240 <span class="preprocessor">#else</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>  <span class="keywordflow">return</span> m_uUncomprSize ? ((float)(__int64)(m_uComprSize) / (<span class="keywordtype">float</span>)(__int64)m_uUncomprSize) * 100: 0;
<a name="l00242"></a>00242 <span class="preprocessor">#endif</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span> }
<a name="l00244"></a>00244 
<a name="l00254"></a>00254  <span class="keywordtype">void</span> SetTime(<span class="keyword">const</span> time_t&amp; ttime);
<a name="l00255"></a>00255 
<a name="l00265"></a>00265  time_t GetTime()<span class="keyword">const</span>;
<a name="l00266"></a>00266 
<a name="l00280"></a><a class="code" href="classCZipFileHeader.html#f39a800b175ab36b1d50e1dcf9278dd7">00280</a>  <span class="keywordtype">int</span> <a class="code" href="classCZipArchive.html#51fc17a93c4414130ef440775503fc3e">GetSystemCompatibility</a>()<span class="keyword">const</span>
<a name="l00281"></a>00281 <span class="keyword"> </span>{
<a name="l00282"></a>00282   <span class="keywordflow">return</span> (m_uVersionMadeBy &amp; 0xFF00) &gt;&gt; 8;
<a name="l00283"></a>00283  }
<a name="l00284"></a>00284 
<a name="l00300"></a>00300  DWORD GetSystemAttr();
<a name="l00301"></a>00301 
<a name="l00312"></a><a class="code" href="classCZipFileHeader.html#1a6ead3939caaf0a0079401562faf90e">00312</a>  DWORD GetOriginalAttributes()<span class="keyword"> const </span>{<span class="keywordflow">return</span> m_uExternalAttr;}
<a name="l00313"></a>00313 
<a name="l00324"></a>00324  <span class="keywordtype">bool</span> <a class="code" href="namespaceZipPlatform.html#62a6f9cb5d789c22c3fc035a3260dbde">IsDirectory</a>();
<a name="l00325"></a>00325 
<a name="l00326"></a>00326  
<a name="l00338"></a><a class="code" href="classCZipFileHeader.html#d4d29775356f406d8f1e6864f90681a0">00338</a>  CZipStringStoreSettings <a class="code" href="classCZipArchive.html#54f26713f4bc6c808250fe5a0b8b0565">GetStringStoreSettings</a>()
<a name="l00339"></a>00339  {
<a name="l00340"></a>00340   <span class="keywordflow">return</span> m_stringSettings;
<a name="l00341"></a>00341  }
<a name="l00342"></a>00342 
<a name="l00354"></a><a class="code" href="classCZipFileHeader.html#d8b33eb8b9e30110b6b6789917aede8c">00354</a>  <span class="keywordtype">bool</span> IsEncrypted()<span class="keyword">const </span>{ <span class="keywordflow">return</span> m_uEncryptionMethod != <a class="code" href="classCZipCryptograph.html#b3e0a46c0680f616ccf7a163f4f40332a72fc2366adc9ba8d011e038717c4f28">CZipCryptograph::encNone</a>;}
<a name="l00355"></a>00355 
<a name="l00362"></a><a class="code" href="classCZipFileHeader.html#00bfd39b6c12d59f957178b5028c0b01">00362</a>  <span class="keywordtype">int</span> <a class="code" href="classCZipArchive.html#31b4d1f238c27c15e971aa3a949c39c2">GetEncryptionMethod</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> m_uEncryptionMethod;}
<a name="l00363"></a>00363 
<a name="l00370"></a><a class="code" href="classCZipFileHeader.html#2a49227056343446d0b7f2701265ee43">00370</a>  <span class="keywordtype">bool</span> IsWinZipAesEncryption()<span class="keyword"> const</span>
<a name="l00371"></a>00371 <span class="keyword"> </span>{
<a name="l00372"></a>00372   <span class="keywordflow">return</span> <a class="code" href="classCZipCryptograph.html#92dc8af1a9ed1c29520c13c0f779af34">CZipCryptograph::IsWinZipAesEncryption</a>(m_uEncryptionMethod);
<a name="l00373"></a>00373  }
<a name="l00374"></a>00374 
<a name="l00381"></a>00381  <span class="keywordtype">int</span> GetCompressionLevel() <span class="keyword">const</span>;
<a name="l00382"></a>00382 
<a name="l00389"></a>00389  DWORD GetEncryptedInfoSize() <span class="keyword">const</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a><a class="code" href="classCZipFileHeader.html#16228f70a6310630a9d146f3a20a2674">00391</a>  <span class="keyword">static</span> <span class="keywordtype">char</span> m_gszSignature[];  
<a name="l00392"></a><a class="code" href="classCZipFileHeader.html#89bead753bbb91bed1294a753941aae2">00392</a>  <span class="keyword">static</span> <span class="keywordtype">char</span> m_gszLocalSignature[]; 
<a name="l00393"></a><a class="code" href="classCZipFileHeader.html#00a271f35a3ecb94bd9de9aa35e68578">00393</a>  WORD m_uVersionMadeBy;   
<a name="l00394"></a><a class="code" href="classCZipFileHeader.html#6fd090bf501e8a0510bddcd0aed13cda">00394</a>  WORD m_uVersionNeeded;   
<a name="l00395"></a><a class="code" href="classCZipFileHeader.html#b4e884870db38a15ab0a4c3264d4b831">00395</a>  WORD m_uFlag;     
<a name="l00396"></a><a class="code" href="classCZipFileHeader.html#565b52e5bc6a1e76f1397db36bee4c44">00396</a>  WORD m_uMethod;     
<a name="l00397"></a><a class="code" href="classCZipFileHeader.html#f0bfaac1f7740dd65af7c308bcd13375">00397</a>  WORD m_uModTime;    
<a name="l00398"></a><a class="code" href="classCZipFileHeader.html#f7e50dae2693615ca6a98ebc464d3721">00398</a>  WORD m_uModDate;    
<a name="l00399"></a><a class="code" href="classCZipFileHeader.html#51290cd4bca1cd5a699d93fe1b77ce85">00399</a>  DWORD m_uCrc32;     
<a name="l00400"></a><a class="code" href="classCZipFileHeader.html#cc8d92c81be6f2deb85697816852998c">00400</a>  ZIP_U32_U64 m_uComprSize;  
<a name="l00401"></a><a class="code" href="classCZipFileHeader.html#88ec251f0caee80f40deb5e5b6de20b9">00401</a>  ZIP_U32_U64 m_uUncomprSize;  
<a name="l00402"></a><a class="code" href="classCZipFileHeader.html#4e325b05e4f3e491be8ea5b70df714d7">00402</a>  ZIP_U16_U32 m_uDiskStart;  
<a name="l00403"></a><a class="code" href="classCZipFileHeader.html#113f74710dde6dd31a29a937f16b1879">00403</a>  WORD m_uInternalAttr;   
<a name="l00404"></a><a class="code" href="classCZipFileHeader.html#45ab3c2119a25a3a3c95fa65eba60654">00404</a>  ZIP_U32_U64 m_uLocalComprSize; 
<a name="l00405"></a><a class="code" href="classCZipFileHeader.html#73c4225826d635b13f82e3f0af47545b">00405</a>  ZIP_U32_U64 m_uLocalUncomprSize;
<a name="l00406"></a><a class="code" href="classCZipFileHeader.html#840bfde285ff0f307d6973cdb298a10a">00406</a>  ZIP_U32_U64 m_uOffset;    
<a name="l00407"></a><a class="code" href="classCZipFileHeader.html#e4cbf85b55f10be47fa3782a0bb812b8">00407</a>  <a class="code" href="classCZipExtraField.html">CZipExtraField</a> m_aLocalExtraData; 
<a name="l00408"></a><a class="code" href="classCZipFileHeader.html#a9d85b6500481bb3067106d908a8766f">00408</a>  <a class="code" href="classCZipExtraField.html">CZipExtraField</a> m_aCentralExtraData; 
<a name="l00409"></a>00409 <span class="keyword">protected</span>:
<a name="l00410"></a><a class="code" href="classCZipFileHeader.html#6ee6254a89990dfd2e8732c6f83cecee">00410</a>  DWORD m_uExternalAttr;   
<a name="l00411"></a><a class="code" href="classCZipFileHeader.html#f0f317e4a4e6780def4a66539cfb9451">00411</a>   WORD m_uLocalFileNameSize;  
<a name="l00412"></a><a class="code" href="classCZipFileHeader.html#3bc293dc09763e332424c87e1992d696">00412</a>  BYTE m_uEncryptionMethod;  
<a name="l00413"></a><a class="code" href="classCZipFileHeader.html#425c5f6567cfdad42ef92b47c334d8ed">00413</a>  <span class="keywordtype">bool</span> m_bIgnoreCrc32;   
<a name="l00414"></a>00414 
<a name="l00415"></a>00415  
<a name="l00416"></a>00416 
<a name="l00426"></a><a class="code" href="classCZipFileHeader.html#28db2c395dd229e465d134a346f13374">00426</a>  <span class="keywordtype">void</span> <a class="code" href="classCZipArchive.html#3b22230148bd8a11a9f1f92bff446e1b">SetSystemCompatibility</a>(<span class="keywordtype">int</span> iSystemID)
<a name="l00427"></a>00427  {
<a name="l00428"></a>00428   m_uVersionMadeBy &amp;= 0x00FF;
<a name="l00429"></a>00429   m_uVersionMadeBy |= (WORD)(iSystemID &lt;&lt; 8);
<a name="l00430"></a>00430  }
<a name="l00431"></a>00431 
<a name="l00448"></a>00448  <span class="keywordtype">void</span> SetSystemAttr(DWORD uAttr);
<a name="l00449"></a>00449  
<a name="l00453"></a><a class="code" href="classCZipFileHeader.html#9a6e9917d34fff43f257b6b5c5abb53c">00453</a>  <span class="keywordtype">void</span> PrepareFileName()
<a name="l00454"></a>00454  {
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (m_pszFileNameBuffer.IsAllocated() || m_pszFileName == NULL)
<a name="l00456"></a>00456    <span class="keywordflow">return</span>;
<a name="l00457"></a>00457   ConvertFileName(m_pszFileNameBuffer);
<a name="l00458"></a>00458  }
<a name="l00459"></a>00459 
<a name="l00469"></a>00469  <span class="keywordtype">bool</span> CheckDataDescriptor(<a class="code" href="classCZipStorage.html">CZipStorage</a>* pStorage) <span class="keyword">const</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 
<a name="l00485"></a>00485  <span class="keywordtype">void</span> PrepareData(<span class="keywordtype">int</span> iLevel, <span class="keywordtype">bool</span> bEncrypted, <span class="keywordtype">bool</span> bSegm);
<a name="l00486"></a>00486 
<a name="l00497"></a>00497  <span class="keywordtype">void</span> WriteLocal(<a class="code" href="classCZipStorage.html">CZipStorage</a> *pStorage);
<a name="l00498"></a>00498 
<a name="l00511"></a>00511  <span class="keywordtype">bool</span> ReadLocal(<a class="code" href="classCZipStorage.html">CZipStorage</a> *pStorage);
<a name="l00512"></a>00512 
<a name="l00525"></a>00525  DWORD Write(<a class="code" href="classCZipStorage.html">CZipStorage</a> *pStorage);
<a name="l00526"></a>00526 
<a name="l00539"></a>00539  <span class="keywordtype">bool</span> Read(<a class="code" href="classCZipStorage.html">CZipStorage</a> *pStorage);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 
<a name="l00549"></a><a class="code" href="classCZipFileHeader.html#79e0298aa1dd36586a9e7ff0e2929c35">00549</a>  <span class="keywordtype">bool</span> CheckLengths(<span class="keywordtype">bool</span> local)<span class="keyword"> const</span>
<a name="l00550"></a>00550 <span class="keyword"> </span>{
<a name="l00551"></a>00551   <span class="keywordflow">if</span> (m_pszComment.GetSize() &gt; USHRT_MAX || m_pszFileNameBuffer.GetSize() &gt; USHRT_MAX)
<a name="l00552"></a>00552    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00553"></a>00553   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (local)
<a name="l00554"></a>00554    <span class="keywordflow">return</span> m_aLocalExtraData.Validate();
<a name="l00555"></a>00555   <span class="keywordflow">else</span>
<a name="l00556"></a>00556    <span class="keywordflow">return</span> m_aCentralExtraData.Validate();
<a name="l00557"></a>00557  }
<a name="l00558"></a>00558 
<a name="l00565"></a><a class="code" href="classCZipFileHeader.html#428ceb8a8c8dc269e8f562474c278932">00565</a>  <span class="keywordtype">void</span> WriteCrc32(<span class="keywordtype">char</span>* pBuf)<span class="keyword"> const</span>
<a name="l00566"></a>00566 <span class="keyword"> </span>{
<a name="l00567"></a>00567   DWORD uCrc = m_bIgnoreCrc32 ? 0 : m_uCrc32;
<a name="l00568"></a>00568   <a class="code" href="classCBytesWriter.html#dff826914352722661389cc14ff45b9b">CBytesWriter::WriteBytes</a>(pBuf, &amp;uCrc, 4);
<a name="l00569"></a>00569  }
<a name="l00570"></a>00570  
<a name="l00578"></a><a class="code" href="classCZipFileHeader.html#f236844235816c140e7b95dafca48e55">00578</a>  <span class="keywordtype">bool</span> NeedsDataDescriptor()<span class="keyword"> const</span>
<a name="l00579"></a>00579 <span class="keyword"> </span>{
<a name="l00580"></a>00580 <span class="preprocessor">#ifdef _ZIP64</span>
<a name="l00581"></a>00581 <span class="preprocessor"></span>  <span class="comment">// we could not write local extra zip64 header and that's why we use the data descriptor (local sizes are 0)</span>
<a name="l00582"></a>00582   <span class="keywordflow">return</span> IsEncrypted() || m_uComprSize &gt;= UINT_MAX &amp;&amp; m_uLocalComprSize == 0 || m_uUncomprSize &gt;= UINT_MAX &amp;&amp; m_uLocalUncomprSize == 0;
<a name="l00583"></a>00583 <span class="preprocessor">#else</span>
<a name="l00584"></a>00584 <span class="preprocessor"></span>  <span class="keywordflow">return</span> IsEncrypted();
<a name="l00585"></a>00585 <span class="preprocessor">#endif</span>
<a name="l00586"></a>00586 <span class="preprocessor"></span> }
<a name="l00587"></a>00587 
<a name="l00597"></a>00597  <span class="keywordtype">void</span> WriteSmallDataDescriptor(<span class="keywordtype">char</span>* pDest, <span class="keywordtype">bool</span> bLocal = <span class="keyword">true</span>);
<a name="l00598"></a>00598 
<a name="l00605"></a>00605  <span class="keywordtype">void</span> WriteDataDescriptor(<a class="code" href="classCZipStorage.html">CZipStorage</a>* pStorage);
<a name="l00606"></a>00606 
<a name="l00613"></a>00613  <span class="keywordtype">void</span> UpdateLocalHeader(<a class="code" href="classCZipStorage.html">CZipStorage</a>* pStorage);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="keyword">private</span>:
<a name="l00616"></a>00616 
<a name="l00623"></a>00623  <span class="keywordtype">void</span> SetVersion(WORD uVersion)
<a name="l00624"></a>00624  {
<a name="l00625"></a>00625   <span class="keywordflow">if</span> ((m_uVersionMadeBy &amp; 0x00FF) != (uVersion &amp; 0x00FF)) 
<a name="l00626"></a>00626   {
<a name="l00627"></a>00627    m_uVersionMadeBy &amp;= 0xFF00;
<a name="l00628"></a>00628    m_uVersionMadeBy |= (WORD)(uVersion &amp; 0x00FF);
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630  }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632  <span class="keywordtype">void</span> ConvertFileName(<a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a>&amp; buffer) <span class="keyword">const</span>;
<a name="l00633"></a>00633  <span class="keywordtype">void</span> ConvertFileName(CZipString&amp; szFileName) <span class="keyword">const</span>;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635  <span class="keywordtype">void</span> ClearFileName()
<a name="l00636"></a>00636  {
<a name="l00637"></a>00637   <span class="keywordflow">if</span> (m_stringSettings.m_bStoreNameInExtraData)
<a name="l00638"></a>00638    <span class="comment">// we are keeping m_pszFileName, clear the buffer, we need the original, when writing extra header and when accessing the filename</span>
<a name="l00639"></a>00639    m_pszFileNameBuffer.Release();
<a name="l00640"></a>00640   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_pszFileName != NULL)
<a name="l00641"></a>00641   {
<a name="l00642"></a>00642    <span class="keyword">delete</span> m_pszFileName;
<a name="l00643"></a>00643    m_pszFileName = NULL;
<a name="l00644"></a>00644   }
<a name="l00645"></a>00645  }
<a name="l00646"></a>00646 
<a name="l00647"></a>00647  <span class="keywordtype">void</span> GetCrcAndSizes(<span class="keywordtype">char</span>* pBuffer)<span class="keyword">const</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649  <span class="keywordtype">bool</span> NeedsZip64()<span class="keyword"> const</span>
<a name="l00650"></a>00650 <span class="keyword"> </span>{
<a name="l00651"></a>00651   <span class="keywordflow">return</span> m_uComprSize &gt;= UINT_MAX || m_uUncomprSize &gt;= UINT_MAX || m_uDiskStart &gt;= USHRT_MAX || m_uOffset &gt;= UINT_MAX;
<a name="l00652"></a>00652  }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 <span class="preprocessor">#ifdef _ZIP_AES</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span> <span class="keyword">static</span> <span class="keywordtype">bool</span> ReadWinZipAesExtra(<a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a>&amp; data, WORD&amp; uVersion, BYTE&amp; uStrength, WORD&amp; uCompressionMethod);
<a name="l00656"></a>00656  <span class="keywordtype">int</span> CZipFileHeader::WriteWinZipAesExtra(<a class="code" href="classCZipExtraField.html">CZipExtraField</a>&amp; field);
<a name="l00657"></a>00657 <span class="preprocessor">#endif</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span>
<a name="l00659"></a>00659  <a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a> m_pszFileNameBuffer;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661  CZipString* m_pszFileName;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663  CZipStringStoreSettings m_stringSettings;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665  <a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a> m_pszComment;
<a name="l00666"></a>00666 };
<a name="l00667"></a>00667 
<a name="l00668"></a>00668 <span class="preprocessor">#endif // !defined(ZIPARCHIVE_ZIPFILEHEADER_DOT_H)</span>
</pre></div><hr><address><small>
The ZipArchive Library Copyright &copy;&nbsp;2000 - 2006 Tadeusz Dracz. Generated at Mon Nov 27 21:42:23 2006.
</small></address>
</body>
</html>
